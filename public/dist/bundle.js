var e;function t(){assetsManager=new FruitGame.AssetsManager,assetsManager.addEventListener("complete",i),assetsManager.start()}function i(){document.getElementById("loading").style.display="none",multiplayer&&(topLeftCanvas=document.getElementById("top-left"),topLeftCanvas.style.display="block",topLeftCanvas.width=gameWidth/2,topLeftCanvas.height=gameHeight,topLeftCanvas.style.width="auto",topLeftContext=topLeftCanvas.getContext("2d"),topLeftContext.globalCompositeOperation="lighter",middleLeftCanvas=document.getElementById("middle-left"),middleLeftCanvas.style.display="block",middleLeftCanvas.width=gameWidth/2,middleLeftCanvas.height=gameHeight,middleLeftCanvas.style.width="auto",middleLeftContext=middleLeftCanvas.getContext("2d"),bottomLeftCanvas=document.getElementById("bottom-left"),bottomLeftCanvas.style.display="block",bottomLeftCanvas.width=gameWidth/2,bottomLeftCanvas.height=gameHeight,bottomLeftCanvas.style.width="auto",bottomLeftContext=bottomLeftCanvas.getContext("2d"),bottomLeftContext.fillStyle="white",bottomLeftContext.textAlign="left",bottomLeftContext.textBaseline="top",topRightCanvas=document.getElementById("top-right"),topRightCanvas.style.display="block",topRightCanvas.width=gameWidth/2,topRightCanvas.height=gameHeight,topRightCanvas.style.width="auto",topRightCanvas.style.right=0,topRightCanvas.style.left="auto",topRightContext=topRightCanvas.getContext("2d"),topRightContext.globalCompositeOperation="lighter",middleRightCanvas=document.getElementById("middle-right"),middleRightCanvas.style.display="block",middleRightCanvas.width=gameWidth/2,middleRightCanvas.height=gameHeight,middleRightCanvas.style.width="auto",middleRightCanvas.style.right=0,middleRightCanvas.style.left="auto",middleRightContext=middleRightCanvas.getContext("2d"),bottomRightCanvas=document.getElementById("bottom-right"),bottomRightCanvas.style.display="block",bottomRightCanvas.width=gameWidth/2,bottomRightCanvas.height=gameHeight,bottomRightCanvas.style.width="auto",bottomRightCanvas.style.right=0,bottomRightCanvas.style.left="auto",bottomRightContext=bottomRightCanvas.getContext("2d"),bottomRightContext.fillStyle="white",bottomRightContext.textAlign="Right",bottomRightContext.textBaseline="top"),topCanvas=document.getElementById("top"),topCanvas.style.display="block",topCanvas.width=gameWidth,topCanvas.height=gameHeight,topContext=topCanvas.getContext("2d"),topContext.globalCompositeOperation="lighter",middleCanvas=document.getElementById("middle"),middleCanvas.style.display="block",middleCanvas.width=gameWidth,middleCanvas.height=gameHeight,middleContext=middleCanvas.getContext("2d"),bottomCanvas=document.getElementById("bottom"),bottomCanvas.style.display="block",bottomCanvas.width=gameWidth,bottomCanvas.height=gameHeight,bottomContext=bottomCanvas.getContext("2d"),bottomContext.fillStyle="white",bottomContext.textAlign="left",bottomContext.textBaseline="top",textCanvas=document.getElementById("text"),textCanvas.style.display="block",textCanvas.width=gameWidth,textCanvas.height=gameHeight,textContext=textCanvas.getContext("2d"),textContext.fillStyle="white",textContext.textAlign="left",textContext.textBaseline="top",scoreCanvas=document.getElementById("score-text"),scoreCanvas.style.display="block",scoreCanvas.width=gameWidth,scoreCanvas.height=gameHeight,scoreContext=scoreCanvas.getContext("2d"),scoreContext.fillStyle="white",scoreContext.textAlign="left",scoreContext.textBaseline="top",particleSystem=new SPP.ParticleSystem,particleSystem.start(),bladeSystem=new SPP.ParticleSystem,bladeSystem.start(),fruitSystem=new SPP.ParticleSystem,fruitSystem.start(),bombSystem=new SPP.ParticleSystem,bombSystem.start(),gravity=new SPP.Gravity(.15),void 0!==chrome.storage?storage=chrome.storage.local:storage=window.localStorage,storage.highScore||(storage.highScore=0),gameState=GAME_READY,multiplayer?(scoreRight=0,scoreLeft=0,gameLifeLeft=5,ui_gamelifeTextureLeft=assetsManager["gamelife-5"],gameLifeRight=5,ui_gamelifeTextureRight=assetsManager["gamelife-5"]):(score=0,gameLife=5,ui_gamelifeTexture=assetsManager["gamelife-5"]),gameLevel=.1,multiplayer&&(topLeftCanvas.addEventListener("mousemove",y,!1),topLeftCanvas.addEventListener("mouseleave",p,!1),topLeftCanvas.addEventListener("mouseenter",f,!1),topRightCanvas.addEventListener("mousemove",y,!1),topRightCanvas.addEventListener("mouseleave",p,!1),topRightCanvas.addEventListener("mouseenter",f,!1)),topCanvas.addEventListener("mousemove",y,!1),topCanvas.addEventListener("mouseleave",p,!1),topCanvas.addEventListener("mouseenter",f,!1),Webcam.set({width:320,height:240,dest_width:640,dest_height:480,image_format:"png",force_flash:!1,flip_horiz:!0,fps:45}),Webcam.attach("#camera"),themeMusic=createjs.Sound.createInstance("mainTheme"),themeMusic.loop=-1,themeMusic.volume=1,scoresController=new O,scoresController.listenToScores(),F(),x(),o()}function o(){showStartGameUI()}function s(){gameState=GAME_READY,multiplayer?(scoreLeft=0,gameLifeLeft=5,ui_gamelifeTextureLeft=assetsManager["gamelife-5"],scoreRight=0,gameLifeRight=5,ui_gamelifeTextureRight=assetsManager["gamelife-5"],updateHudLeft=0,updateHudRight=0):(score=0,gameLife=5,ui_gamelifeTexture=assetsManager["gamelife-5"],updateHud=0),clearText(),updateAutomation=0,gameLevel=.1}function n(t){hideStartGameUI(),e&&(e.removeEventListener("dead",L),TweenLite.to(e,.5,{scale:0,alpha:0,ease:Back.easeOut,onComplete:()=>{e.life=0}})),startTime=(new Date).getTime(),endTime=null,bladeHistory=[],fruitHistory=[],cutHistory=[],powerUpsHistory=[],s(),showScoreUI(),gameState=GAME_PLAYING,setTimeout(()=>{themeMusic.play(),themeMusic.loop=-1,themeMusic.volume=1},1e3),multiplayer&&(document.body.className+=" playing")}function r(){gameState==GAME_PLAYING&&(timer+=SPP.frameTime,timer>=interval&&(timer=0,l()))}function l(){for(var e=1+(4*Math.random()>>0),t=0;t<e;t++)multiplayer?d()?(throwBomb(middleLeftContext),throwBomb(middleRightContext)):(throwFruit(middleLeftContext,"left"),throwFruit(middleRightContext,"right")):d()?throwBomb(middleContext):throwFruit(middleContext)}function d(){return 2*Math.random()<gameLevel}function m(){gameLevel+=levelStep,gameLevel>1&&(gameLevel=.1)}function u(e="middle"){if(gameState!=GAME_OVER){slowMo=!0;for(var t=fruitSystem.getParticles().length;t-- >0;)fruitSystem.getParticles()[t].removeEventListener("dead",missHandler);gameState=GAME_OVER,multiplayer?("left"===e?(gameLifeLeft=0,ui_gamelifeTextureLeft=assetsManager["gamelife-"+gameLifeLeft],ui_gameLifeLeft.texture=ui_gamelifeTextureLeft):"right"===e&&(gameLifeRight=0,ui_gamelifeTextureRight=assetsManager["gamelife-"+gameLifeRight],ui_gameLifeRight.texture=ui_gamelifeTextureRight),document.body.className=""):(gameLife=0,ui_gamelifeTexture=assetsManager["gamelife-"+gameLife],ui_gameLife.texture=ui_gamelifeTexture),score>parseInt(storage.highScore)&&(storage.highScore=score),setTimeout(()=>{var e=Math.floor(99999*Math.random()+1);currentlyPlaying.stop(),g(),themeMusic.stop(),score>=scoresController.scores[4].score?currentlyPlaying=createjs.Sound.play("topTen"+(e%2+1)):currentlyPlaying=createjs.Sound.play("gameOver"+(e%5+1))},1e3),showGameoverUI()}}function c(){h()}function g(e=50,t="down"){let a=0;if("down"==t)for(let t=100;t>=0;t-=10)a++,setTimeout(()=>{themeMusic.volume=t/100},e*a);else for(let t=0;t<=100;t+=10)a++,setTimeout(()=>{themeMusic.volume=t/100},e*a)}function h(e){hideGameoverUI()}function p(e){allBlades={},bladeSystems={}}function f(e){allBlades={mouse:bladeColors[Math.floor(Math.random()*bladeColors.length)]},bladeSystems.mouse=new SPP.ParticleSystem,bladeSystems.mouse.start(),bladeContexes.mouse=e.target.getContext("2d"),bladeCanvases.mouse=e.target.canvas}function w(e){const t=e.changedTouches,a={};for(let o=0;o<t.length;o++){var i="touch";t[o].identifier>=bladeReplayIdentifier+autoIdentifier?i="autoreplay":t[o].identifier>=bladeReplayIdentifier?i="replay":t[o].identifier>autoIdentifier&&(i="auto"),bladeSystems[i+t[o].identifier]||(bladeSystems[i+t[o].identifier]=new SPP.ParticleSystem,bladeSystems[i+t[o].identifier].start(),bladeCanvases[i+t[o].identifier]=e.target,bladeContexes[i+t[o].identifier]=e.target.getContext("2d")),a[i+t[o].identifier]=bladeColors[o],k(e,t[o],i+t[o].identifier)}allBlades=a}function y(e){e.layerX||0==e.layerX?(mouse.x=e.layerX,mouse.y=e.layerY):(e.offsetX||0==e.offsetX)&&(mouse.x=e.offsetX,mouse.y=e.offsetY),buildBladeParticle(mouse.x,mouse.y,"mouse")}function v(e){allBlades=[bladeColors[0]],buildBladeParticle(e.x,e.y,"mouse"),console.log(e)}function x(){(setTimeout(()=>{requestAnimationFrame(x)},slowMo?20:0),realSlowmo)?(document.querySelector(".wrapper .sliding-background").className="sliding-background stretch",ui_hudPower.texture=assetsManager.slowMoActive,ui_hudPower.position.x=157.5,ui_hudPower.position.y=gameHeight-96.5):document.querySelector(".wrapper .sliding-background").className="sliding-background"+(gameState!==GAME_PLAYING&&gameState!==REPLAY?" hidden":"");if(isAutomation||slowMo||transparency||isLlamas||(ui_hudPower.texture=assetsManager.hudPower,ui_hudPower.position.x=150,ui_hudPower.position.y=gameHeight-107),powerUpsHistory.push({time:(new Date).getTime(),slowMo:slowMo,isAutomation:isAutomation,ultraSlice:ultraSlice,transparency:transparency,isLlamas:isLlamas}),multiplayer?(topContext.clearRect(0,0,gameWidth,gameHeight),middleContext.clearRect(0,0,gameWidth,gameHeight),bottomContext.clearRect(0,0,gameWidth,gameHeight),topLeftContext.clearRect(0,0,gameWidth/2,gameHeight),middleLeftContext.clearRect(0,0,gameWidth/2,gameHeight),bottomLeftContext.clearRect(0,0,gameWidth/2,gameHeight),showScoreTextUI(bottomLeftContext,scoreLeft),topRightContext.clearRect(0,0,gameWidth/2,gameHeight),middleRightContext.clearRect(0,0,gameWidth/2,gameHeight),bottomRightContext.clearRect(0,0,gameWidth/2,gameHeight),showScoreTextUI(bottomRightContext,scoreRight),gameState===GAME_PLAYING?(topCanvas.style.display="block",bottomCanvas.style.display="block",middleCanvas.style.display="block",topLeftCanvas.style.display="block",bottomLeftCanvas.style.display="block",middleLeftCanvas.style.display="block",topRightCanvas.style.display="block",bottomRightCanvas.style.display="block",middleRightCanvas.style.display="block"):(topLeftCanvas.style.display="none",bottomLeftCanvas.style.display="none",middleLeftCanvas.style.display="none",topRightCanvas.style.display="none",bottomRightCanvas.style.display="none",middleRightCanvas.style.display="none",topCanvas.style.display="block",bottomCanvas.style.display="block",middleCanvas.style.display="block")):(topContext.clearRect(0,0,gameWidth,gameHeight),middleContext.clearRect(0,0,gameWidth,gameHeight),bottomContext.clearRect(0,0,gameWidth,gameHeight),showScoreTextUI(bottomContext,score)),gameState===GAME_PLAYING&&(clearText(),clearScores()),fruitSystem.render(),bombSystem.render(),particleSystem.render(),transparency?(middleContext.globalAlpha=.3,ui_hudPower.texture=assetsManager.transparencyActive,ui_hudPower.position.x=157.5,ui_hudPower.position.y=gameHeight-96.5):middleContext.globalAlpha=1,isLlamas&&(ui_hudPower.texture=assetsManager.mannActive,ui_hudPower.position.x=157.5,ui_hudPower.position.y=gameHeight-96.5),isAutomation||isAutomationLeft||isAutomationRight){var e=[];isAutomation&&e.push("middle"),isAutomationLeft&&e.push("left"),isAutomationRight&&e.push("right"),e.forEach(e=>{var t="wrapper"+("middle"!==e?"-"+e:""),a=document.getElementsByClassName(t)[0];e in automations?(new Date).getTime()-automations[e]>12e3&&(delete automations[e],"left"===e?isAutomationLeft=!1:"right"===e?isAutomationRight=!1:(isAutomation=!1,themeMusic.paused=!1,g(20,"up")),slowMo=!0,setTimeout(()=>slowMo=!1,5e3),a.className=t):(slowMo=!0,currentlyPlaying.stop(),g(20,"down"),currentlyPlaying=createjs.Sound.play("automationActivated"),automations[e]=(new Date).getTime(),setTimeout(()=>{themeMusic.paused=!0,slowMo=!1,a.className=t+" frenzy",currentlyPlaying.stop(),currentlyPlaying=createjs.Sound.play("automationMode")},2e3))}),Object.keys(automations).length>0?(S(),interval=.4):interval=1.8}Object.keys(bladeSystems).forEach(e=>bladeSystems[e].render()),Object.keys(allBlades).forEach(e=>buildColorBlade(allBlades[e],bladeWidth,e)),collideTest(),m(),r()}function C(e,t,a){var i=Math.random()*Math.PI*2;return{x:Math.cos(i)*a+a+e,y:Math.sin(i)*a+a+t}}function S(){ui_hudPower.texture=assetsManager.automationActive,ui_hudPower.position.x=157.5,ui_hudPower.position.y=gameHeight-96.5;fruitSystem.getParticles().length;var e=fruitSystem.getParticles().filter(e=>e.dropScore>0&&e.velocity.y>1&&(new Date).getTime()-e.autoCut>350).sort((e,t)=>e.position.y<t.position.y?1:-1),t=[];Object.keys(automations).forEach(a=>e.filter(e=>e.side===a).slice(0,2).forEach(e=>t.push(e))),t&&t.forEach(e=>{var t,a=fruitSystem.getParticles().filter(e=>e.autoCut),i=C(e.position.x,e.position.y,e.radius),o={x:e.position.x>i.x?i.x+1.5*e.radius:i.x-1.5*e.radius,y:e.position.y>i.y?i.y+1.5*e.radius:i.y-1.5*e.radius};if("left"===e.side){if(!isAutomationLeft)return;t=topLeftCanvas}else if("right"===e.side){if(!isAutomationRight)return;t=topRightCanvas}else{if(!isAutomation)return;t=topCanvas}var s=new TouchEvent("touchmove",{changedTouches:[new Touch({clientX:i.x,clientY:i.y,identifier:autoIdentifier+a.length+1,target:t})]});t.dispatchEvent(s);s=new TouchEvent("touchmove",{changedTouches:[new Touch({clientX:o.x,clientY:o.y,identifier:autoIdentifier+a.length+1,target:t})]});t.dispatchEvent(s),e.autoCut=(new Date).getTime()})}async function L(){hideStartGameUI(),ui_startFruit&&(ui_startFruit.removeEventListener("dead",n),TweenLite.to(ui_startFruit,.5,{scale:0,alpha:0,ease:Back.easeOut,onComplete:()=>{ui_startFruit.life=0}})),s(),showScoreUI(),gameState=REPLAY,T(),I(),_()}async function _(){powerUpsHistory.forEach(e=>{setTimeout(()=>{slowMo=e.slowMo,isAutomation=e.isAutomation,ultraSlice=e.ultraSlice,transparency=e.transparency},e.time-startTime)})}async function T(){bladeHistory.forEach(e=>{setTimeout(()=>{var t=new TouchEvent("touchmove",{changedTouches:[new Touch({clientX:e.x,clientY:e.y,identifier:-1!==e.key.indexOf("auto")?bladeReplayIdentifier+autoIdentifier:bladeReplayIdentifier,target:topCanvas})]});topCanvas.dispatchEvent(t)},e.time-startTime)})}function P(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function M(){var e=0;for(let t=0;t<bladeHistory.length-1;t++){e+=2.54*P(bladeHistory[t],bladeHistory[t+1])/96}return e}function R(){var e={};return fruitHistory.forEach(t=>{const a=t.texture.name||"bomb";a in e?e[a]++:e[a]=1}),e}function E(){var e={};return cutHistory.forEach(t=>{const a=t.name||"bomb";a in e?e[a]++:e[a]=1}),e}function A(){return{distance:M(),fruits:R(),cuts:E(),startTime:startTime,endTime:endTime}}async function I(){fruitHistory.forEach(e=>{setTimeout(()=>{const{yv:t,rv:a,x:i,y:o,life:s,texture:n,side:r,bottomY:l,context:d,isBomb:m}=e,u=m?bombSystem.createParticle(FruitGame.Fruit):fruitSystem.createParticle(FruitGame.Fruit);u.velocity.reset(0,t),u.velocity.rotate(a),u.damp.reset(0,0),u.addForce("g",gravity),u.addEventListener("dead",missHandler),m?(u.updatePic=0,u.onUpdate=bombUpdate,u.init(i,o,s,n,assetsManager.shadow,d)):(u.init(i,o,s,n.w,assetsManager.shadow,d,n.next,n.life),u.textureObj=n,u.side=r),u.bottomY=l},e.time-startTime)})}window.FruitGame=window.FruitGame||{REVISION:"1",AUTHOR:"flashhawk",GITHUB:"https://github.com/flashhawk"},window.gameWidth=window.innerWidth,window.gameHeight=window.innerHeight,window.topCanvas={},window.topContext={},window.middleCanvas={},window.middleContext={},window.bottomCanvas={},window.bottomContext={},window.textCanvas={},window.scoreCanvas={},window.textContext={},window.scoreContext={},window.topLeftCanvas={},window.topLeftContext={},window.middleLeftCanvas={},window.middleLeftContext={},window.bottomLeftCanvas={},window.bottomLeftContext={},window.bottomLeftScoreContext={},window.topRightCanvas={},window.topRightContext={},window.middleRightCanvas={},window.middleRightContext={},window.bottomRightCanvas={},window.bottomRightContext={},window.bottomRightScoreContext={},window.particleSystem={},window.fruitSystem={},window.bombSystem={},window.bladeSystem={},window.gravity={},window.timer=0,window.interval=1.8,window.bladeColor={},window.bladeWidth={},window.mouse={},window.score={},window.scoreLeft=0,window.scoreRight=0,window.gameLife={},window.gameLifeLeft={},window.gameLifeRight={},window.storage={},window.isPlaying={},window.GAME_READY=1,GAME_PLAYING=2,GAME_OVER=3,REPLAY=4,window.gameState={},window.gameLevel={},window.levelStep=1e-4,window.ui_gameTitle={},window.ui_newGame={},window.ui_startFruit={},window.ui_scoreIcon={},window.ui_gameLife={},window.ui_gamelifeTexture={},window.ui_gameLifeLeft={},window.ui_gamelifeTextureLeft={},window.ui_gameLifeRight={},window.ui_gamelifeTextureRight={},window.ui_gameover={},window.collide={},window.allBlades={},window.bladeSystems={},window.bladeColors=["#00FF00","#FF0000","#0000FF","#FFFF00","#FF00FF","#00FFFF"],window.isAutomation=!1,window.isAutomationLeft=!1,window.isAutomationRight=!1,window.automations={},window.automationStarted={},window.autoIdentifier=30,window.bladeCanvases={},window.bladeContexes={},window.multiplayer=!1,window.lineDrawn=!1,window.startTime={},window.endTime={},window.bladeHistory=[],window.fruitHistory=[],window.cutHistory=[],window.bladeReplayIdentifier=100,window.bombUpdate={},window.slowMo=!1,window.updateHud={},window.updateHudLeft={},window.updateHudRight={},window.updateAutomation=0,window.transparency=!1,window.ultraSlice=!1,window.playerName="",window.nameLength=3,window.powerUpsHistory=[],window.showGood={},window.showingGood=!1,window.ui_hudPowerActive={},window.ui_hudPower={position:{}},window.scoresController={},window.getStats={},window.isLlamas=!1,window.letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","@","!","&"],window.themeMusic={},window.realSlowmo=!1,window.currentlyPlaying={},window.royTheme={},window.slowMoTheme={},function(){var t=function(){this.rotation+=.01};showStartGameUI=function(){gameState=GAME_READY,ui_newGame=particleSystem.createParticle(SPP.SpriteImage),ui_newGame.init(.318*gameWidth,.618*gameHeight,1/0,assetsManager.newgame,topContext),ui_newGame.scale=5,ui_newGame.alpha=0,ui_newGame.onUpdate=t,TweenLite.to(ui_newGame,.8,{scale:.55,alpha:1,ease:Back.easeOut,onComplete:scoresController.topScores}),bladeHistory.length,ui_startFruit=fruitSystem.createParticle(FruitGame.Fruit),ui_startFruit.addEventListener("dead",n);var e=assetsManager.getFruitByName("stuck");ui_startFruit.init(.318*gameWidth,.618*gameHeight,1/0,e.w,assetsManager.shadow,topContext),ui_startFruit.rotationStep=-.02,ui_startFruit.scale=0,ui_startFruit.alpha=0,ui_startFruit.textureObj=e,ui_startFruit.side="middle",TweenLite.to(ui_startFruit,1,{scale:1,alpha:1,ease:Back.easeOut});var a=document.getElementsByClassName("wrapper")[0],i=document.getElementsByClassName("wrapper-left")[0],o=document.getElementsByClassName("wrapper-right")[0],s=document.getElementsByClassName("regular-background")[0],r=document.querySelector(".wrapper .sliding-background"),l=document.querySelector(".wrapper-left .sliding-background"),d=document.querySelector(".wrapper-right .sliding-background"),m=document.querySelector(".wrapper .sliding-parallax"),u=document.querySelector(".wrapper .sliding-parallax2"),c=document.querySelector(".wrapper-left .sliding-parallax"),g=document.querySelector(".wrapper-right .sliding-parallax"),h=document.querySelector(".wrapper-left .sliding-parallax2"),p=document.querySelector(".wrapper-right .sliding-parallax2");r.className="sliding-background hidden",l.className="sliding-background hidden",d.className="sliding-background hidden",m.className="sliding-parallax hidden",c.className="sliding-parallax hidden",g.className="sliding-parallax hidden",u.className="sliding-parallax2 hidden",h.className="sliding-parallax2 hidden",p.className="sliding-parallax2 hidden",a.className="wrapper",i.className="wrapper-left",o.className="wrapper-right",s.className="regular-background"},hideStartGameUI=function(){if(ui_startFruit.removeEventListener("dead",n),currentlyPlaying=createjs.Sound.play("ankYou"),e&&e.removeEventListener("dead",L),TweenLite.to(ui_newGame,.8,{scale:8,alpha:0,onComplete:function(){ui_newGame.life=0}}),multiplayer){var t=document.getElementsByClassName("wrapper-left")[0],a=document.getElementsByClassName("wrapper-right")[0],i=document.querySelector(".wrapper-left .sliding-background"),o=document.querySelector(".wrapper-right .sliding-background"),s=document.querySelector(".wrapper-left .sliding-parallax"),r=document.querySelector(".wrapper-right .sliding-parallax"),l=document.querySelector(".wrapper-left .sliding-parallax2"),d=document.querySelector(".wrapper-right .sliding-parallax2");i.className="sliding-background",s.className="sliding-parallax",l.className="sliding-parallax2",isAutomationLeft&&(t.className="wrapper-left frenzy"),o.className="sliding-background",r.className="sliding-parallax",d.className="sliding-parallax2",isAutomationRight&&(a.className="wrapper-right frenzy")}else{var m=document.getElementsByClassName("wrapper")[0],u=document.getElementsByClassName("sliding-background")[0],c=document.getElementsByClassName("sliding-parallax")[0],g=document.getElementsByClassName("sliding-parallax2")[0];u.className="sliding-background",c.className="sliding-parallax",g.className="sliding-parallax2",isAutomation&&(m.className="wrapper frenzy")}document.getElementsByClassName("regular-background")[0].className="regular-background hidden"},showScoreTextUI=function(t,a){if(gameState==GAME_READY)return e&&(bottomContext.fillStyle="yellow",bottomContext.font="36px 'Arial'",bottomContext.fillText("- Swipe to replay -",630,650)),void(bottomContext.fillStyle="white");t.font="italic 36px 'Arial'",t.fillText(a,.2*ui_hud.texture.width,gameHeight-80),t.setTransform(1,0,0,1,0,0),-1!==t.canvas.id.indexOf("left")?("left",gameLifeLeft<=1&&(updateHudLeft+=1/8,Math.floor(updateHudLeft)%2==0?ui_hudLeft.texture=assetsManager.hudbad:ui_hudLeft.texture=assetsManager.hud)):-1!==t.canvas.id.indexOf("right")?("right",gameLifeRight<=1&&(updateHudRight+=1/8,Math.floor(updateHudRight)%2==0?ui_hudRight.texture=assetsManager.hudbad:ui_hudRight.texture=assetsManager.hud)):("middle",gameLife<=1&&(updateHud+=1/8,Math.floor(updateHud)%2==0?(ui_hud.texture=assetsManager.hudbad,ui_gameLife.alpha=1):(ui_hud.texture=assetsManager.hud,ui_gameLife.alpha=.5)))},showScoreUI=function(){multiplayer?(ui_hudLeft=particleSystem.createParticle(SPP.SpriteImage),ui_hudLeft.regX=ui_hudLeft.regY=0,ui_hudLeft.init(-30,gameHeight-105,1/0,assetsManager.hud,bottomLeftContext),ui_hudLeft.scale=.5,ui_scoreIconLeft=particleSystem.createParticle(SPP.SpriteImage),ui_scoreIconLeft.regX=ui_scoreIconLeft.regY=0,ui_scoreIconLeft.init(10,gameHeight-75,1/0,assetsManager.score,bottomLeftContext),ui_scoreIconLeft.scale=.5,ui_gameLifeLeft=particleSystem.createParticle(SPP.SpriteImage),ui_gameLifeLeft.regX=1,ui_gameLifeLeft.regY=0,ui_gameLifeLeft.scale=.5,ui_gameLifeLeft.init(165,bottomLeftContext.canvas.height-70,1/0,ui_gamelifeTextureLeft,bottomLeftContext),ui_hudRight=particleSystem.createParticle(SPP.SpriteImage),ui_hudRight.regX=ui_hudRight.regY=0,ui_hudRight.init(-30,gameHeight-105,1/0,assetsManager.hud,bottomRightContext),ui_hudRight.scale=.5,ui_scoreIconRight=particleSystem.createParticle(SPP.SpriteImage),ui_scoreIconRight.regX=ui_scoreIconRight.regY=0,ui_scoreIconRight.init(10,gameHeight-75,1/0,assetsManager.score,bottomRightContext),ui_scoreIconRight.scale=.5,ui_scoreIconRight=particleSystem.createParticle(SPP.SpriteImage),ui_scoreIconRight.regX=ui_scoreIconRight.regY=0,ui_scoreIconRight.init(10,gameHeight-75,1/0,assetsManager.score,bottomRightContext),ui_scoreIconRight.scale=.5,ui_gameLifeRight=particleSystem.createParticle(SPP.SpriteImage),ui_gameLifeRight.regX=1,ui_gameLifeRight.regY=0,ui_gameLifeRight.scale=.5,ui_gameLifeRight.init(165,bottomRightContext.canvas.height-70,1/0,ui_gamelifeTextureRight,bottomRightContext)):(ui_hud=particleSystem.createParticle(SPP.SpriteImage),ui_hud.regX=ui_hud.regY=0,ui_hud.init(0,gameHeight-105,1/0,assetsManager.hud,bottomContext),ui_hud.scale=.5,ui_hudPower=particleSystem.createParticle(SPP.SpriteImage),ui_hudPower.regX=ui_hudPower.regY=0,ui_hudPower.init(150,gameHeight-107,1/0,assetsManager.hudPower,bottomContext),ui_hudPower.scale=.5,ui_hudPowerActive=particleSystem.createParticle(SPP.SpriteImage),ui_hudPowerActive.regX=ui_hudPowerActive.regY=0,ui_hudPowerActive.init(164,gameHeight-87,1/0,null,bottomContext),ui_hudPowerActive.scale=.5,ui_scoreIcon=particleSystem.createParticle(SPP.SpriteImage),ui_scoreIcon.regX=ui_scoreIcon.regY=0,ui_scoreIcon.init(10,gameHeight-75,1/0,assetsManager.score,bottomContext),ui_scoreIcon.scale=.5,ui_gameLife=particleSystem.createParticle(SPP.SpriteImage),ui_gameLife.regX=1,ui_gameLife.regY=0,ui_gameLife.scale=.5,ui_gameLife.init(165,gameHeight-70,1/0,ui_gamelifeTexture,bottomContext))},hideScoreUI=function(){void 0!=window.ui_scoreIcon&&(window.ui_scoreIcon.life=0),void 0!=window.ui_hud&&(window.ui_hud.life=0),void 0!=window.ui_hudPower&&(window.ui_hudPower.life=0),void 0!=window.ui_hudPowerActive&&(window.ui_hudPowerActive.life=0),void 0!=window.ui_gameLife&&(window.ui_gameLife.life=0),void 0!=window.ui_scoreIconLeft&&(window.ui_scoreIconLeft.life=0),void 0!=window.ui_gameLifeLeft&&(window.ui_gameLifeLeft.life=0),void 0!=window.ui_scoreIconRight&&(window.ui_scoreIconRight.life=0),void 0!=window.ui_gameLifeRight&&(window.ui_gameLifeRight.life=0)},showGameoverUI=function(){endTime=(new Date).getTime(),ui_gameOver=particleSystem.createParticle(SPP.SpriteImage),ui_gameOver.init(.5*gameWidth,.5*gameHeight,1/0,assetsManager.gameover,topContext),ui_gameOver.scale=0,TweenLite.to(ui_gameOver,.8,{delay:2,scale:1.6,ease:Back.linear,onComplete:raiseGameOver}),enterScoreDelay(4),enterNameDelay(4),document.body.addEventListener("keydown",a,!0)},raiseGameOver=function(){TweenLite.to(ui_gameOver.position,.8,{delay:1,y:.15*gameHeight,ease:Back.linear,onComplete:c})},showGood=function(e=.5*gameWidth,t=.5*gameHeight){var a,i=Math.floor(9999999*Math.random()+1);i%5==0?a="nice":i%5==1?a="wow":i%5==2?a="excellent":i%5==3?a="zinman":i%5==4&&(a="boom"),good_ui=particleSystem.createParticle(SPP.SpriteImage),good_ui.init(e,t,1/0,assetsManager[a+"Image"],topContext),good_ui.scale=0,TweenLite.to(good_ui,.5,{scale:.2,ease:Back.easeOut,onComplete:()=>{TweenLite.to(good_ui,.5,{delay:0,scale:0,ease:Back.easeIn,onComplete:()=>{showingGood=!1}})}}),isLlamas||realSlowMo||(themeMusic.volume=.5),currentlyPlaying=createjs.Sound.play(a),setTimeout(()=>{isLlamas||realSlowMo||(themeMusic.volume=1)},1e3)};var a=async function(e){gameState===GAME_OVER&&handleName(e),13===e.keyCode&&gameState===GAME_OVER&&(showStartGameUI(),hideScoreUI(),TweenLite.to(ui_gameOver,.1,{scale:0,ease:Back.easeIn,onComplete:i}),await scoresController.insertScore(playerName,score),s(),document.body.removeEventListener("keydown",a,!0),playerName="")},i=function(){ui_gameOver.life=0,hideScoreUI(),slowMo=!1};hideGameoverUI=function(){}}(),FruitGame.assets={fruits:["done","working","stuck","automation","transparency","slowMo","llama","mann"],fruitsLives:[1,2,3,1,1,1,1,1],nextFruits:[null,"done","working",null,null,null,null,null],other:[{id:"gameover",src:"assets/gameover.png"},{id:"gametitle",src:"assets/gametitle.png"},{id:"shadow",src:"assets/shadow.png"},{id:"bomb",src:"assets/bomb.png"},{id:"bomblight",src:"assets/bomb-light.png"},{id:"miss",src:"assets/miss.png"},{id:"star",src:"assets/star.png"},{id:"score",src:"assets/score.png"},{id:"hud",src:"assets/hud.png"},{id:"hudPower",src:"assets/hudPower.png"},{id:"hudbad",src:"assets/hudbad.png"},{id:"gamelife-5",src:"assets/5Life.png"},{id:"gamelife-4",src:"assets/4Life.png"},{id:"gamelife-3",src:"assets/3Life.png"},{id:"gamelife-2",src:"assets/2Life.png"},{id:"gamelife-1",src:"assets/1Life.png"},{id:"zinmanImage",src:"assets/zinman.png"},{id:"niceImage",src:"assets/Nice.png"},{id:"wowImage",src:"assets/wow.png"},{id:"boomImage",src:"assets/Boom.png"},{id:"excellentImage",src:"assets/Excellent_.png"},{id:"newgame",src:"assets/newgame-new.png"},{id:"automationPink",src:"assets/OtemationLogoPink.png"},{id:"automationBlue",src:"assets/OtemationLogoBlue.png"},{id:"automationGreen",src:"assets/OtemationLogoGreen.png"},{id:"automationActive",src:"assets/HUD_OtemationActive.png"},{id:"slowMoPink",src:"assets/TimeLineLogoPink.png"},{id:"slowMoBlue",src:"assets/TimeLineLogoBlue.png"},{id:"slowMoGreen",src:"assets/TimeLineLogoGreen.png"},{id:"slowMoActive",src:"assets/HUD_SlowMoActive.png"},{id:"transparencyPink",src:"assets/ZinmanPink.png"},{id:"transparencyBlue",src:"assets/ZinmanBlue.png"},{id:"transparencyGreen",src:"assets/ZinmanGreen.png"},{id:"transparencyActive",src:"assets/HUD_ZinmanActive.png"},{id:"mannPink",src:"assets/MannPink.png"},{id:"mannBlue",src:"assets/MannBlue.png"},{id:"mannGreen",src:"assets/MannGreen.png"},{id:"mannActive",src:"assets/HUD_MannActive.png"},{id:"throwFruit",src:"assets/sound/throw-fruit.ogg"},{id:"automationActivated",src:"assets/sound/AutomationActivated.mp3"},{id:"automationMode",src:"assets/sound/Automation_01.mp3"},{id:"mainTheme",src:"assets/sound/maintheme.wav"},{id:"slowMoTheme",src:"assets/sound/SlowMoTheme_01.mp4"},{id:"slowMoActivated",src:"assets/sound/SlowMoActivate_01.mp3"},{id:"royTheme",src:"assets/sound/RoyTheme2.mp3"},{id:"dueDates",src:"assets/sound/DueDates_02.mp3"},{id:"gameOver1",src:"assets/sound/GameOver_01.mp3"},{id:"gameOver2",src:"assets/sound/GameOver_02.mp3"},{id:"gameOver3",src:"assets/sound/GameOver_03.mp3"},{id:"gameOver4",src:"assets/sound/GameOver_04.mp3"},{id:"gameOver5",src:"assets/sound/GameOver_05.mp3"},{id:"touchMe1",src:"assets/sound/TouchMe_01.mp3"},{id:"touchMe2",src:"assets/sound/TouchMe2_01.mp3"},{id:"touchMe3",src:"assets/sound/TouchMe3_01.mp3"},{id:"transparency1",src:"assets/sound/Transparency_01.mp3"},{id:"transparency2",src:"assets/sound/Transparency_02.mp3"},{id:"transparency3",src:"assets/sound/Transparency_03.mp3"},{id:"transparency4",src:"assets/sound/Transparency_04.mp3"},{id:"transparency5",src:"assets/sound/Transparency_05.mp3"},{id:"transparency6",src:"assets/sound/Transparency_06.mp3"},{id:"topTen1",src:"assets/sound/TopTen1_01.mp3"},{id:"topTen2",src:"assets/sound/TopTen2_01.mp3"},{id:"zinman",src:"assets/sound/Zinman_01.mp3"},{id:"excellent",src:"assets/sound/Excellent.mp3"},{id:"wow",src:"assets/sound/WOW.mp3"},{id:"nice",src:"assets/sound/NICE.mp3"},{id:"boom",src:"assets/sound/Boom.mp3"},{id:"bombExplode",src:"assets/sound/bomb-explode.mp3"},{id:"ankYou",src:"assets/sound/ankYou2.m4a"},{id:"?",src:"assets/sound/abc/questionMark.mp3"},{id:"hash",src:"assets/sound/abc/hash.mp3"},{id:"splatter",src:"assets/sound/splatter.ogg"}]},letters.forEach(e=>{FruitGame.assets.other.push({id:e,src:`assets/sound/abc/${e}.mp3`})}),FruitGame.AssetsManager=function(){SPP.EventDispatcher.call(this);var e=this,t=0,a=0,i=["w","l","r"];this.fruitsObj={},this.fruitsArray=[],this.images={},this.sounds={},this.loader=new createjs.LoadQueue,this.loader.installPlugin(createjs.Sound),this.loader.setMaxConnections(20);this.loader.addEventListener("complete",function(){var o=FruitGame.assets.fruits,s=FruitGame.assets.fruitsLives,n=FruitGame.assets.nextFruits;for(t=0;t<o.length;t++){var r={};for(a=0;a<i.length;a++)r[i[a]]=e.loader.getResult(o[t]+i[a]);r.life=s[t],r.next=n[t],r.name=o[t],e.fruitsArray.push(r),e.fruitsObj[o[t]]=r}var l=FruitGame.assets.other;for(t=0;t<l.length;t++)e[l[t].id]=e.loader.getResult(l[t].id);e.dispatchEvent(new SPP.Event("complete"))}),this.start=function(){var e=FruitGame.assets.fruits;for(t=0;t<e.length;t++)for(a=0;a<i.length;a++)this.loader.loadFile({id:e[t]+i[a],src:"assets/fruits/"+e[t]+"-"+i[a]+".png"},!1);this.loader.loadManifest(FruitGame.assets.other,!1),this.loader.load()},this.getRandomFruit=function(){if(isLlamas)return this.fruitsObj.llama;var e=this.fruitsArray[this.fruitsArray.length*Math.random()>>0];return"automation"===e.name||"slowMo"===e.name||"transparency"===e.name||"mann"===e.name?Math.floor(30*Math.random()+1)%30!=0||isAutomation||slowMo||transparency?this.getRandomFruit():e:"llama"===e.name?this.getRandomFruit():e},this.getFruitByName=function(e){return this.fruitsObj[e]}},FruitGame.Collide=function(){function e(e){return e*e}function t(e){return e<0?-1:e>0?1:0}function i(i,o,s,n,r){if(!(n<=0)){var l,d=n,m=n*(r=void 0===r?1:r);if(a=e(m)*e(i[0]-o[0])+e(d)*e(i[1]-o[1]),!(a<=0)&&(b=2*e(m)*(o[0]-i[0])*(i[0]-s[0])+2*e(d)*(o[1]-i[1])*(i[1]-s[1]),s=e(m)*e(i[0]-s[0])+e(d)*e(i[1]-s[1])-e(d)*e(m),l=function(e,t,a){if(0!=e){var i=t*t-4*e*a;return 0==i?[-1*t/(2*e),-1*t/(2*e)]:i>0?[(-1*t+Math.sqrt(i))/(2*e),(-1*t-Math.sqrt(i))/(2*e)]:void 0}}(a,b,s))){var u=[[i[0]+l[0]*(o[0]-i[0]),i[1]+l[0]*(o[1]-i[1])],[i[0]+l[1]*(o[0]-i[0]),i[1]+l[1]*(o[1]-i[1])]];return t(u[0][0]-i[0])*t(u[0][0]-o[0])<=0&&t(u[0][1]-i[1])*t(u[0][1]-o[1])<=0||(u[0]=null),t(u[1][0]-i[0])*t(u[1][0]-o[0])<=0&&t(u[1][1]-i[1])*t(u[1][1]-o[1])<=0||(u[1]=null),u}}}this.lineInEllipse=function(e,t,a,o,s){var n=i(e,t,a,o,s);return n&&(n[0]||n[1])}},FruitGame.Fruit=function(){SPP.Particle.call(this),this.drawTexture=function(e,t,a,i){e.drawImage(t,a,i,t.width,t.height,.5*-t.width,.5*-t.height,t.width,t.height)}},FruitGame.Fruit.prototype=SPP.inherit(SPP.Particle.prototype),FruitGame.Fruit.prototype.constructor=FruitGame.Fruit,FruitGame.Fruit.prototype.update=function(){this.rotation+=this.rotationStep,this.context.translate(this.position.x-20,this.position.y-20),this.context.scale(this.scale,this.scale),!this.textureObj||"automation"!==this.textureObj.name&&"slowMo"!==this.textureObj.name&&"transparency"!==this.textureObj.name&&"mann"!==this.textureObj.name||(updateAutomation+=1/32,Math.floor(updateAutomation)%3==0?this.texture=assetsManager[this.textureObj.name+"Blue"]:Math.floor(updateAutomation)%3==1?this.texture=assetsManager[this.textureObj.name+"Green"]:Math.floor(updateAutomation)%3==2&&(this.texture=assetsManager[this.textureObj.name+"Pink"]),this.scale=.5),this.drawTexture(this.context,this.shadow,0,0),this.context.setTransform(1,0,0,1,0,0),this.context.translate(this.position.x,this.position.y),this.context.rotate(this.rotation),this.context.scale(this.scale,this.scale),this.drawTexture(this.context,this.texture,0,0),this.context.setTransform(1,0,0,1,0,0),(this.position.y>this.bottomY&&null!=this.bottomY||this.position.x<=0||this.position.x>gameWidth)&&(this.life=0)},FruitGame.Fruit.prototype.init=function(e,t,a,i,o,s,n=null,r=1,l=!1){SPP.Particle.prototype.init.apply(this,[e,t,a]),this.context=s,this.texture=i,this.shadow=o,this.rotation=0,this.scale=1,this.radius=i.width>=i.height?.5*i.width:.5*i.height,this.radius*=this.scale,this.bottomY=null,this.next=n,this.dropScore=r,this.createdAt=(new Date).getTime(),this.autoCut=0,this.isHalf=l,this.isCut=!1,this.rotationStep=.1*(1-2*Math.random()),this.rotationStep<=0?this.rotationStep=-.1:this.rotationStep>0&&(this.rotationStep=.1)},window.onload=t;var H={message:"Game Control",moveThreshold:5,depthThreshold:70,displayShadow:!0,mirror:!0};function G(){var e=new dat.GUI;e.add(H,"message"),e.add(H,"moveThreshold",0,10).step(1),e.add(H,"depthThreshold",10,255).step(1).onChange(function(e){}),e.add(H,"displayShadow").onChange(function(e){var t=document.getElementById("shadow");t.style.display=e?"block":"none"}),e.add(H,"mirror"),e.close()}function k(e,t,a){buildBladeParticle(t.clientX,t.clientY,a),e.preventDefault()}function F(){multiplayer?(topLeftCanvas.addEventListener("touchstart",w,!0),topLeftCanvas.addEventListener("touchmove",w,!0),topLeftCanvas.addEventListener("touchend",w,!0),topLeftCanvas.addEventListener("touchcancel",w,!0),topRightCanvas.addEventListener("touchstart",w,!0),topRightCanvas.addEventListener("touchmove",w,!0),topRightCanvas.addEventListener("touchend",w,!0),topRightCanvas.addEventListener("touchcancel",w,!0),topCanvas.addEventListener("touchstart",w,!0),topCanvas.addEventListener("touchmove",w,!0),topCanvas.addEventListener("touchend",w,!0),topCanvas.addEventListener("touchcancel",w,!0),document.body.addEventListener("keydown",e=>{13===e.keyCode&&(isAutomationLeft=!0)},!0),document.body.addEventListener("keydown",e=>{8===e.keyCode&&(isAutomationRight=!0)},!0)):(topCanvas.addEventListener("touchstart",w,!0),topCanvas.addEventListener("touchmove",w,!0),topCanvas.addEventListener("touchend",w,!0),topCanvas.addEventListener("touchcancel",w,!0),document.body.addEventListener("keydown",e=>{9===e.keyCode&&u()},!0),document.body.addEventListener("keydown",e=>{13===e.keyCode&&gameState!==GAME_OVER&&(isAutomation=!0)},!0),document.body.addEventListener("keydown",e=>{16===e.keyCode&&(slowMo=!slowMo)},!0),document.body.addEventListener("keydown",e=>{8===e.keyCode&&gameState===GAME_PLAYING&&(transparency=!transparency)},!0),document.body.addEventListener("keydown",e=>{27===e.keyCode&&(ultraSlice=!ultraSlice)},!0),gameState,GAME_OVER)}!function(){bladeColor="#00ff00",bladeWidth=10;var e=function(e){gameState!=GAME_OVER&&Object.keys(bladeSystems).forEach(t=>{var a=bladeSystems[t],i=bladeContexes[t],o=(bladeCanvases[t],a.getParticles().length),s=e,n=e/(o-1);for(i.beginPath();o-- >1;){i.lineWidth=1==o?1:s;var r=a.getParticles()[o],l=a.getParticles()[o-1];i.moveTo(r.position.x,r.position.y),i.lineTo(l.position.x,l.position.y),i.stroke(),(s-=n)<=0&&(s=1)}})};buildColorBlade=function(t,a,i){var o=bladeContexes[i];o.strokeStyle=t,e(a),o.strokeStyle="#ffffff",e(.6*a)},buildBladeParticle=function(e,t,a){gameState===GAME_PLAYING&&bladeHistory.push({time:(new Date).getTime(),x:e,y:t,key:a}),bladeSystems[a].createParticle(SPP.Particle).init(e,t,.2)}}(),function(){var e=function(){this.scale-=.03,this.scale<0&&(this.scale=0,this.life=0)};bombUpdate=function(){this.updatePic+=1/32,this.texture=Math.floor(this.updatePic)%2?assetsManager.bomblight:assetsManager.bomb;var t=particleSystem.createParticle(SPP.SpriteImage),a=1.414*assetsManager.bomb.width*.5-5,i=this.position.x+a*Math.cos(this.rotation-SPP.MathUtils.toRadian(135)),o=this.position.y+a*Math.sin(this.rotation-SPP.MathUtils.toRadian(135));t.init(i,o,1/0,assetsManager.star,topContext),t.onUpdate=e,t.scale=.8,t.damp.reset(0,0),t.velocity.reset(0,-(1+1*Math.random())),t.velocity.rotate(360*Math.random()),t.addForce("g",gravity);t=particleSystem.createParticle(SPP.SpriteImage),a=1.414*assetsManager.bomblight.width*.5-5,i=this.position.x+a*Math.cos(this.rotation-SPP.MathUtils.toRadian(135)),o=this.position.y+a*Math.sin(this.rotation-SPP.MathUtils.toRadian(135));t.init(i,o,1/0,assetsManager.star,topContext),t.onUpdate=e,t.scale=.8,t.damp.reset(0,0),t.velocity.reset(0,-(1+1*Math.random())),t.velocity.rotate(360*Math.random()),t.addForce("g",gravity)};var t=function(){this.scale-=.02,this.scale<0&&(this.scale=0,this.life=0)};throwBomb=function(e){Math.floor(999999*Math.random()+1)%10!=0||isAutomation||(themeMusic.volume=.5,currentlyPlaying=createjs.Sound.play("dueDates"),setTimeout(()=>{themeMusic.volume=1},3e3));var t=bombSystem.createParticle(FruitGame.Fruit),a=-(10+3*Math.random()),i=8-16*Math.random();t.velocity.reset(0,a),t.velocity.rotate(i),t.damp.reset(0,0),t.addForce("g",gravity),t.onUpdate=bombUpdate;var o=.5*e.canvas.width+300*(1-2*Math.random()),s=gameHeight+assetsManager.bomb.height,n=assetsManager.bomb;t.init(o,s,1/0,n,assetsManager.shadow,e),t.bottomY=gameHeight+assetsManager.bomb.height,t.updatePic=0,fruitHistory.push({x:o,y:s,yv:a,rv:i,life:1/0,texture:n,side:t.side,bottomY:t.bottomY,context:e,time:(new Date).getTime(),isBomb:!0})},cutBomb=function(e){transparency?cutHistory.push({name:"bombTransparent",time:(new Date).getTime()}):(cutHistory.push({name:"bomb",time:(new Date).getTime()}),function(e){for(var a=0;a<150;a++){var i=particleSystem.createParticle(SPP.SpriteImage);i.init(e.position.x,e.position.y,1/0,assetsManager.star,topContext),i.onUpdate=t,i.scale=2,i.damp.reset(0,0),i.velocity.reset(0,-(3+7*Math.random())),i.velocity.rotate(360*Math.random()),i.addForce("g",gravity)}currentlyPlaying.stop(),themeMusic.volume=.5,currentlyPlaying=createjs.Sound.play("bombExplode")}(e),e.life=0,u())}}(),collide=new FruitGame.Collide,collideTest=function(){if(gameState!=GAME_OVER){var e,t,a=fruitSystem.getParticles(),i=bombSystem.getParticles();Object.keys(bladeSystems).forEach(o=>{for(var s=bladeSystems[o].getParticles(),n=s.length;n-- >1;){var r=s[n],l=s[n-1];for(var d in a){e=a[d];var m,u=collide.lineInEllipse([r.position.x,r.position.y],[l.position.x,l.position.y],[e.position.x,e.position.y],e.radius);m=-1!==bladeContexes[o].canvas.id.indexOf("left")?"left":-1!==bladeContexes[o].canvas.id.indexOf("right")?"right":"middle",u&&!e.isCut&&(ultraSlice||(new Date).getTime()-e.createdAt>250)&&e.side===m&&cutFruit(e)}for(var c in i)t=i[c],r=s[n],l=s[n-1],(u=collide.lineInEllipse([r.position.x,r.position.y],[l.position.x,l.position.y],[t.position.x,t.position.y],t.radius))&&-1===o.indexOf("auto")&&cutBomb(t)}})}},function(){var e=function(e,t=1){var a=(3+3*Math.random())*t,i=particleSystem.createParticle(FruitGame.Fruit);i.init(e.position.x,e.position.y,1/0,e.textureObj.r,assetsManager.shadow,e.context),i.velocity.reset(a,0),i.damp.reset(0,0),i.bottomY=gameHeight+e.textureObj.r.height,i.addForce("g",gravity),i.isCut=!0;var o=particleSystem.createParticle(FruitGame.Fruit);o.init(e.position.x,e.position.y,1/0,e.textureObj.l,assetsManager.shadow,e.context),o.velocity.reset(-a,0),o.damp.reset(0,0),o.bottomY=gameHeight+e.textureObj.l.height,o.addForce("g",gravity),i.isCut=!0,1===t&&(i.velocity.rotate(-50*Math.random()),i.rotation=e.rotation,o.velocity.rotate(50*Math.random()),o.rotation=e.rotation),"automation"!=e.textureObj.name&&"transparency"!=e.textureObj.name&&"slowMo"!=e.textureObj.name&&"mann"!=e.textureObj.name&&"llama"!=e.textureObj.name||(i.scale=.5,o.scale=.5)},t=function(){this.alpha-=.01,this.alpha<0&&(this.alpha=0,this.life=0)};throwFruit=function(e,t="middle"){const a=assetsManager.getRandomFruit(),i=fruitSystem.createParticle(FruitGame.Fruit);var o=-(10+6*Math.random()),s=8-2*Math.random();i.velocity.reset(0,o),i.velocity.rotate(s),i.damp.reset(0,0),i.addForce("g",gravity),i.addEventListener("dead",missHandler);var n=.5*e.canvas.width+200*(1-2*Math.random()),r=gameHeight+a.w.height,l=a;i.init(n,r,1/0,l.w,assetsManager.shadow,e,l.next,l.life),i.textureObj=l,i.side=t,i.bottomY=gameHeight+a.w.height,"llama"===l.name&&(i.scale=.5,i.velocity.reset(0,1.5*o)),fruitHistory.push({x:n,y:r,yv:o,rv:s,life:1/0,texture:l,side:i.side,bottomY:i.bottomY,context:e,time:(new Date).getTime()})},cutFruit=function(t){multiplayer?"left"===t.side?scoreLeft++:scoreRight++:"llama"===t.textureObj.name?score+=10:score++;var a=Math.floor(9999999*Math.random()+1);if(a%15!=0||showingGood||isAutomation||(showGood(t.position.x,t.position.y),showingGood=!0),t.removeEventListener("dead",missHandler),"automation"===t.textureObj.name&&(isAutomation=!0),"transparency"===t.textureObj.name&&(themeMusic.volume=.5,currentlyPlaying.stop(),currentlyPlaying=createjs.Sound.play("transparency"+(a%6+1)),setTimeout(()=>{themeMusic.volume=1},2e3),transparency=!0,setTimeout(()=>{transparency=!1},1e4)),"slowMo"===t.textureObj.name&&(slowMo=!0,realSlowmo=!0,g(30,"down"),slowMoTheme=createjs.Sound.play("slowMoTheme"),setTimeout(()=>{slowMo=!1,realSlowmo=!1,slowMoTheme.stop(),g(50,"up")},1e4)),"mann"===t.textureObj.name&&(isLlamas=!0,g(30,"down"),royTheme=createjs.Sound.play("royTheme"),setTimeout(()=>{isLlamas=!1,royTheme.stop(),g(50,"up")},1e4)),t.life=0,t.isCut=!0,t.next){var i=assetsManager.getFruitByName(t.next),o=fruitSystem.createParticle(FruitGame.Fruit);o.velocity.reset(t.velocity.x,1.2*t.velocity.y),o.damp.reset(0,0),o.addForce("g",gravity),o.addEventListener("dead",missHandler),o.init(t.position.x,t.position.y,1/0,i.w,assetsManager.shadow,t.context,i.next,i.life),o.textureObj=i,o.bottomY=gameHeight+i.w.height,o.side=t.side,e(t,10)}else e(t);cutHistory.push({name:t.textureObj.name,time:(new Date).getTime()})},missHandler=function(e){var a,i,o;(e.target.removeEventListener("dead",missHandler),e.target.dropScore-1==0||transparency)||gameState!=GAME_OVER&&(a=e.target,i=particleSystem.createParticle(SPP.SpriteImage),(o=a.position.x)<=0&&(o=40),o>gameWidth&&(o=gameWidth-40),i.init(o,gameHeight-assetsManager.miss.height/2,1/0,assetsManager.miss,a.context),i.scale=.5,i.velocity.reset(0,-1),i.damp.reset(.01,.01),i.onUpdate=t,"left"===e.target.side?(gameLifeLeft-=e.target.dropScore-1,gameLifeLeft<=0&&u("left"),gameLifeLeft<0&&(gameLifeLeft=0),ui_gamelifeTextureLeft=assetsManager["gamelife-"+gameLifeLeft],ui_gameLifeLeft.texture=ui_gamelifeTextureLeft):"right"===e.target.side?(gameLifeRight-=e.target.dropScore-1,gameLifeRight<=0&&u("right"),gameLifeRight<0&&(gameLifeRight=0),ui_gamelifeTextureRight=assetsManager["gamelife-"+gameLifeRight],ui_gameLifeRight.texture=ui_gamelifeTextureRight):(gameLife-=e.target.dropScore-1,gameLife<=0&&u("middle"),gameLife<0&&(gameLife=0),ui_gamelifeTexture=assetsManager["gamelife-"+gameLife],ui_gameLife.texture=ui_gamelifeTexture))}}(),neonWrite=function(e,t,a,i,o=30){t.font="700 "+o+"px 'Sofia Pro ', sans-serif",t.fillStyle="rgb(255,255,255)",t.fillText(e,a,i),t.lineWidth=1,t.strokeStyle="rgb(255,255,255)",t.fillStyle="white",t.fillText(e,a,i),t.strokeText(e,a,i)},blackWrite=function(e,t,a,i,o=30){t.font=o+"px 'Sofia Pro 900', sans-serif",t.fillStyle="rgb(30,30,30)",t.fillText(e,a,i),t.lineWidth=1,t.strokeStyle="rgb(30,30,30)",t.fillStyle="black",t.fillText(e,a,i),t.strokeText(e,a,i)},typeToScreen=function(e,t,a,i=0,o=30,s=neonWrite,n=textContext){return new Promise(r=>{n.fillStyle="white",n.font=o+"px 'Sofia Pro Bold', sans-serifs";var l,d=0;!function m(){d++,l=e.substr(0,d),clearText(t-30,a-30,o*e.length,o+90),s(l,n,t,a,o),d<=e.length?setTimeout(m,i):r(!0)}()})},clearText=function(e=0,t=0,a=gameWidth,i=gameHeight){textContext.clearRect(e,t,a,i)},clearScores=function(e=0,t=0,a=gameWidth,i=gameHeight){scoreContext.clearRect(e,t,a,i)},flashInput=function(e,t,a,i=150,o=90){var s=textContext.measureText(playerName),n=textContext.measureText(" "),r=s.width+n.width*playerName.length,l=(playerName+"_".repeat(nameLength-playerName.length)).split("").join(" ");clearText(e-30,t-30,textContext.measureText(l).width+90,o+90),neonWrite(l,textContext,e,t,o),typeToScreen(playerName.length>=nameLength?"":a,r+e,t,i,o).then(()=>{if(gameState==GAME_OVER){window.flashTimer=setTimeout(()=>{flashInput(e,t,a,i,o)},i);var s=textContext.measureText(a);clearText(r+e-5,t-30,s.width+10,o+90)}else clearText(0,0,gameWidth,gameHeight)})},enterName=function(){var e=(playerName+"_".repeat(nameLength-playerName.length)).split("").join(" ");console.log(gameWidth),height=gameHeight<880?.6*gameHeight:.5*gameHeight,console.log(gameHeight),typeToScreen("ENTER NAME:",gameWidth/2,gameHeight/3,0,80).then(()=>typeToScreen(e,gameWidth/2,height,0,112).then(()=>flashInput(gameWidth/2,height,"_",150,112)))},enterScore=function(){typeToScreen("SCORE:",gameWidth/6,gameHeight/3,0,80),height=gameHeight<880?.6*gameHeight:.5*gameHeight,typeToScreen(score.toString(),gameWidth/6,height,0,112)},enterScores=function(e){e.forEach(function(e,t){typeToScreen(e.username.toString(),.7*gameWidth,.326*gameHeight+.086*t*gameHeight,0,32,blackWrite,scoreContext),typeToScreen(e.score.toString(),.87*gameWidth,.326*gameHeight+.086*t*gameHeight,0,32,blackWrite,scoreContext)})},enterNameDelay=function(e){setTimeout(enterName,1e3*e)},enterScoreDelay=function(e){setTimeout(enterScore,1e3*e)},handleName=function(e){(e.keyCode>=65&&e.keyCode<=90||e.keyCode>48&&e.keyCode<57||"?"===e.key)&&playerName.length<nameLength&&(playerName+=e.key.toUpperCase(),currentlyPlaying.stop(),currentlyPlaying=createjs.Sound.play("#"===e.key?"hash":e.key.toUpperCase())),8===e.keyCode&&(playerName=playerName.slice(0,-1))};class O{constructor(){this.scores=[],this.database=firebase.database(),this.firestore=firebase.firestore(),this.storageRef=firebase.storage().ref(),this.firestore.settings({timestampsInSnapshots:!0})}listenToScores(){const e=this;this.firestoreUnsub&&(this.firestoreUnsub(),this.firestoreUnsub=null),this.firestoreUnsub=this.firestore.collection("scores").orderBy("score","desc").orderBy("date","asc").limit(10).onSnapshot(function(t){e.saveScores(t.docs.map(e=>e.data()))})}listenToTopScores(e=null,t=null,a=10){const i=this,o=t;let s;e?s=e:(s=new Date).setDate(s.getDate()-7),this.firestoreUnsub&&(this.firestoreUnsub(),this.firestoreUnsub=null),this.firestoreUnsub=this.firestore.collection("scores").where("date",">=",s).where("date",o?"<=":">=",o||s).onSnapshot(function(e){i.saveScores(e.docs.map(e=>e.data()).sort((e,t)=>e.score>t.score?-1:1).slice(0,a))})}filterObject(e,t){return t.map(function(t){return e[t]})}topScores(){return gameState==GAME_READY&&enterScores(scoresController.scores.slice(0,5)),scoresController.scores.slice(0,5)}getTopScores(e=null,t=null,a=10){const i=this,o=t;let s;e?s=e:(s=new Date).setDate(s.getDate()-7),this.firestore.collection("scores").where("date",">=",s).where("date",o?"<=":">=",o||s).get().then(function(e){i.saveScores(e.docs.map(e=>e.data()).sort((e,t)=>e.score>t.score?-1:1).slice(0,a)),i.topScores()})}getScores(){const e=this;this.firestore.collection("scores").orderBy("score","desc").orderBy("date","asc").limit(10).get().then(function(t){e.saveScores(t.docs.map(e=>e.data())),e.topScores()})}saveScores(e){this.scores=e,clearScores(),this.topScores()}async insertScore(e,t){const a=new Date,i=this.storageRef,o=await this.insertStats(e);this.firestore.collection("scores").add({username:e,score:t,date:a,statsId:o}).then(function(e){console.log("Document successfully written!",e.id),Webcam.snap(function(t){var a=i.child(`score_image/${e.id}.png`);a.putString(t,"data_url").then(function(e){console.log(`Uploaded image: ${a.fullPath}`)})})}).catch(function(e){console.error("Error writing document: ",e)})}async insertStats(e){const t=new Date;try{const a=await this.firestore.collection("stats").add({username:e,stats:A(),date:t});return console.log("Document successfully written!",a.id),a.id}catch(e){console.error("Error writing document: ",e)}}}function B(e,t){supportsWebGL()?(gl=getWebGLContext(t),createProgramFromURIs(gl,{vsURI:"shaders/simple.vs",fsURI:"shaders/depth.fs",onComplete:function(a){!function(a){gl.useProgram(a);var i=gl.getUniformLocation(a,"width"),o=gl.getUniformLocation(a,"height"),s=gl.getUniformLocation(a,"sampler0"),n=gl.getAttribLocation(a,"position"),r=gl.getUniformLocation(a,"mirror"),l=gl.createBuffer(),d=gl.createTexture();gl.uniform1f(r,H.mirror?1:0),gl.uniform1f(i,t.width),gl.uniform1f(o,t.height),gl.uniform1i(s,0),gl.bindBuffer(gl.ARRAY_BUFFER,l),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW),gl.enableVertexAttribArray(n),gl.vertexAttribPointer(n,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,d),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.bindTexture(gl.TEXTURE_2D,null),window.requestAnimationFrame(function a(){gl.uniform1f(r,H.mirror?1:0),gl.uniform1f(i,t.width),gl.uniform1f(o,t.height),gl.viewport(0,0,t.width,t.height),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,d),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e),gl.drawArrays(gl.TRIANGLES,0,6),gl.bindTexture(gl.TEXTURE_2D,null),window.requestAnimationFrame(a)})}(a)}})):console.log("no WebGL")}